@{
    ViewData["Title"] = "Test Authentication";
}

<div class="container mt-5">
    <h2>Test Authentication</h2>
    
    <div class="row">
        <div class="col-md-6">
            <div class="card">
                <div class="card-header">
                    <h5>Current User Info</h5>
                </div>
                <div class="card-body">
                    <p><strong>Is Authenticated:</strong> @User.Identity?.IsAuthenticated</p>
                    <p><strong>Authentication Type:</strong> @User.Identity?.AuthenticationType</p>
                    <p><strong>Username:</strong> @User.Identity?.Name</p>
                    <p><strong>User ID:</strong> @User.FindFirst(System.Security.Claims.ClaimTypes.NameIdentifier)?.Value</p>
                    <p><strong>Role:</strong> @User.FindFirst(System.Security.Claims.ClaimTypes.Role)?.Value</p>
                </div>
            </div>
        </div>
        
        <div class="col-md-6">
            <div class="card">
                <div class="card-header">
                    <h5>Actions</h5>
                </div>
                <div class="card-body">
                    <a href="/Admin/Dashboard" class="btn btn-primary">Go to Admin Dashboard</a>
                    <a href="/Student/Dashboard" class="btn btn-success">Go to Student Dashboard</a>
                    <a href="/Teacher/Dashboard" class="btn btn-warning">Go to Teacher Dashboard</a>
                    <button onclick="logout()" class="btn btn-danger">Logout</button>
                </div>
            </div>
        </div>
    </div>
    
    <div class="row mt-4">
        <div class="col-md-12">
            <div class="card">
                <div class="card-header">
                    <h5>Debug Info</h5>
                </div>
                <div class="card-body">
                    <button onclick="testAuth()" class="btn btn-info">Test Auth API</button>
                    <button onclick="debugIdentity()" class="btn btn-secondary">Debug Identity</button>
                    <div id="debug-result" class="mt-3"></div>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
    async function testAuth() {
        try {
            const response = await fetch('/api/auth/test-auth');
            const data = await response.json();
            
            document.getElementById('debug-result').innerHTML = `
                <div class="alert alert-info">
                    <pre>${JSON.stringify(data, null, 2)}</pre>
                </div>
            `;
        } catch (error) {
            document.getElementById('debug-result').innerHTML = `
                <div class="alert alert-danger">
                    Error: ${error.message}
                </div>
            `;
        }
    }

    async function debugIdentity() {
        try {
            const response = await fetch('/api/auth/debug-identity');
            const data = await response.json();
            
            document.getElementById('debug-result').innerHTML = `
                <div class="alert alert-info">
                    <pre>${JSON.stringify(data, null, 2)}</pre>
                </div>
            `;
        } catch (error) {
            document.getElementById('debug-result').innerHTML = `
                <div class="alert alert-danger">
                    Error: ${error.message}
                </div>
            `;
        }
    }

    async function logout() {
        try {
            const response = await fetch('/api/auth/logout', { method: 'POST' });
            if (response.ok) {
                window.location.href = '/Auth/Login';
            }
        } catch (error) {
            console.error('Logout error:', error);
        }
    }
</script>
